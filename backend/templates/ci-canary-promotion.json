{
  "id": "ci-canary-promotion",
  "title": "CI: Canary Promotion",
  "description": "Monitor canary cohort metrics and promote canary to production if health checks pass for a period.",
  "category": "CI/CD",
  "tags": ["ci", "canary", "deploy"],
  "sample_input": {"canary_id": "c-1", "monitor_period_minutes": 30},
  "graph": {
    "nodes": [
      {
        "id": "in",
        "type": "input",
        "position": {"x": 0, "y": 0},
        "data": {"label": "Canary Deployed"}
      },
      {
        "id": "monitor",
        "type": "http",
        "position": {"x": 220, "y": 0},
        "data": {
          "label": "Fetch Canary Metrics",
          "config": {"method": "GET", "url": "https://metrics.api/canary/{{ trigger.canary_id }}"}
        }
      },
      {
        "id": "evaluate",
        "type": "action",
        "position": {"x": 440, "y": 0},
        "data": {
          "label": "Evaluate",
          "config": {
            "language": "python",
            "code": "m = json.loads(input.get('body','{}'))\n# check health over monitor_period\nreturn {'promote': True}"
          }
        }
      },
      {
        "id": "promote",
        "type": "http",
        "position": {"x": 660, "y": 0},
        "data": {
          "label": "Promote to Prod",
          "config": {"method": "POST", "url": "https://k8s.api/canary/{{ trigger.canary_id }}/promote"}
        }
      },
      {
        "id": "notify",
        "type": "http",
        "position": {"x": 660, "y": 120},
        "data": {
          "label": "Notify Team",
          "config": {"method": "POST", "url": "https://hooks.slack.com/services/...", "body": "Canary {{ trigger.canary_id }} promoted"}
        }
      }
    ],
    "edges": [
      {"id": "e1", "source": "in", "target": "monitor"},
      {"id": "e2", "source": "monitor", "target": "evaluate"},
      {"id": "e3", "source": "evaluate", "target": "promote"},
      {"id": "e4", "source": "evaluate", "target": "notify"}
    ]
  }
}
