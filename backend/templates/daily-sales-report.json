{
  "id": "daily-sales-report",
  "title": "Daily Sales Report (CSV -> Email)",
  "description": "Fetch daily sales CSV from an internal API, aggregate totals, generate a summary and email it to stakeholders.",
  "category": "Reporting",
  "tags": ["csv","report","email","schedule"],
  "note": "Intended to run on a daily scheduler. Demonstrates HTTP input, CSV parsing, simple aggregation and sending email via SMTP or webhook.",
  "sample_input": { "date": "2025-01-01", "source_url": "https://internal.api/sales/daily.csv" },
  "graph": {
    "nodes": [
      {"id":"in","type":"input","position":{"x":0,"y":0},"data":{"label":"Scheduler Trigger","config":{}}},
      {"id":"fetch","type":"http","position":{"x":220,"y":0},"data":{"label":"Fetch CSV","config":{"method":"GET","url":"{{ trigger.source_url }}"}}},
      {"id":"parse","type":"action","position":{"x":440,"y":0},"data":{"label":"Parse CSV","config":{"language":"python","code":"from io import StringIO\nimport csv\nreader = csv.DictReader(StringIO(input['body']))\nrows = list(reader)\n# aggregate by region example\nsummary = {}\nfor r in rows:\n    region = r.get('region','unknown')\n    amount = float(r.get('amount',0))\n    summary[region] = summary.get(region,0)+amount\nreturn {'rows': rows, 'summary': summary}"}}},
      {"id":"format","type":"action","position":{"x":660,"y":0},"data":{"label":"Format Summary","config":{"language":"jinja","template":"Daily Sales Summary for {{ trigger.date }}\n{% for region,amt in node_results.parse.summary.items() %}- {{ region }}: ${{ '%.2f'|format(amt) }}\n{% endfor %}"}}},
      {"id":"email","type":"email","position":{"x":880,"y":0},"data":{"label":"Send Email","config":{"to":["ops@example.com","finance@example.com"],"subject":"Daily Sales Report - {{ trigger.date }}","body":"{{ node_results.format }}"}}}
    ],
    "edges": [
      {"id":"e1","source":"in","target":"fetch"},
      {"id":"e2","source":"fetch","target":"parse"},
      {"id":"e3","source":"parse","target":"format"},
      {"id":"e4","source":"format","target":"email"}
    ]
  }
}