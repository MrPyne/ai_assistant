{
  "id": "data-warehouse-retention",
  "title": "Data: Warehouse Retention Policy",
  "description": "Enforce retention policies by archiving or deleting old partitions and documenting actions.",
  "category": "Data",
  "tags": ["data","retention","warehouse"],
  "sample_input": {"days_keep":365},
  "graph": {
    "nodes": [
      {
        "id": "in",
        "type": "input",
        "position": {"x": 0, "y": 0},
        "data": {"label": "Scheduler"}
      },
      {
        "id": "list_partitions",
        "type": "http",
        "position": {"x": 220, "y": 0},
        "data": {
          "label": "List Partitions",
          "config": {"method": "GET", "url": "https://warehouse.api/partitions?older_than={{ trigger.days_keep }}"}
        }
      },
      {
        "id": "archive",
        "type": "action",
        "position": {"x": 440, "y": 0},
        "data": {
          "label": "Archive/Delete",
          "config": {
            "language": "python",
            "code": "parts = json.loads(input.get('body','[]'))\n# archive or drop partitions\nreturn {'archived': len(parts)}"
          }
        }
      },
      {
        "id": "record",
        "type": "http",
        "position": {"x": 660, "y": 0},
        "data": {
          "label": "Record Actions",
          "config": {"method": "POST", "url": "https://audit.api/retention", "body": "{{ node_results.archive }}"}
        }
      }
    ],
    "edges": [
      {"id": "e1", "source": "in", "target": "list_partitions"},
      {"id": "e2", "source": "list_partitions", "target": "archive"},
      {"id": "e3", "source": "archive", "target": "record"}
    ]
  }
}
