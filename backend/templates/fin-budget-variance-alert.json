{
  "id": "fin-budget-variance-alert",
  "title": "Finance: Budget Variance Alert",
  "description": "Monitor actuals vs budget and alert owners when variance exceeds threshold.",
  "category": "Finance",
  "tags": ["finance","alerts","budget"],
  "sample_input": {"department":"Engineering","threshold_pct":10},
  "graph": {
    "nodes": [
      {"id":"in","type":"input","position":{"x":0,"y":0},"data":{"label":"Scheduler"}},
      {"id":"fetch_actuals","type":"http","position":{"x":220,"y":0},"data":{"label":"Fetch Actuals","config":{"method":"GET","url":"https://finance.api/actuals?dept={{ trigger.department }}"}}},
      {"id":"fetch_budget","type":"http","position":{"x":440,"y":0},"data":{"label":"Fetch Budget","config":{"method":"GET","url":"https://finance.api/budgets?dept={{ trigger.department }}"}}},
      {"id":"eval","type":"action","position":{"x":660,"y":0},"data":{"label":"Evaluate Variance","config":{"language":"python","code":"a = json.loads(input.get('body','{}')).get('actual',0)\\nb = json.loads(input.get('body','{}')).get('budget',1)\\nvar = (a-b)/b*100\\nif abs(var) > input.get('threshold_pct',10):\\n    return {'alert': True,'variance': var}\\nreturn {'alert': False}"}}},
      {"id":"notify","type":"http","position":{"x":880,"y":0},"data":{"label":"Notify Owners","config":{"method":"POST","url":"https://hooks.slack.com/services/...","body":"Budget variance {{ node_results.eval.variance }}%"}}}
    ],
    "edges": [
      {"id":"e1","source":"in","target":"fetch_actuals"},
      {"id":"e2","source":"fetch_actuals","target":"fetch_budget"},
      {"id":"e3","source":"fetch_budget","target":"eval"},
      {"id":"e4","source":"eval","target":"notify"}
    ]
  }
}