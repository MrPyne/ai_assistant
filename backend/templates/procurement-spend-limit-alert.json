{
  "id": "procurement-spend-limit-alert",
  "title": "Procurement: Spend Limit Alert",
  "description": "Monitor departmental spend and alert stakeholders when approaching approved spend limits.",
  "category": "Procurement",
  "tags": ["procurement", "budget", "alerts"],
  "sample_input": {"department": "Marketing", "threshold_pct": 90},
  "graph": {
    "nodes": [
      {
        "id": "in",
        "type": "input",
        "position": {"x": 0, "y": 0},
        "data": {"label": "Scheduler"}
      },
      {
        "id": "fetch_spend",
        "type": "http",
        "position": {"x": 220, "y": 0},
        "data": {
          "label": "Fetch Spend",
          "config": {"method": "GET", "url": "https://finance.api/spend?dept={{ trigger.department }}"}
        }
      },
      {
        "id": "eval",
        "type": "action",
        "position": {"x": 440, "y": 0},
        "data": {
          "label": "Evaluate",
          "config": {
            "language": "python",
            "code": "s = json.loads(input.get('body','{}'))\\nif s.get('pct_used',0) > input.get('threshold_pct',90):\\n    return {'alert': True}\\nreturn {'alert': False}"
          }
        }
      },
      {
        "id": "notify",
        "type": "http",
        "position": {"x": 660, "y": 0},
        "data": {
          "label": "Notify Owners",
          "config": {"method": "POST", "url": "https://hooks.slack.com/services/...", "body": "Spend approaching limit: {{ node_results.eval }}"}
        }
      }
    ],
    "edges": [
      {"id": "e1", "source": "in", "target": "fetch_spend"},
      {"id": "e2", "source": "fetch_spend", "target": "eval"},
      {"id": "e3", "source": "eval", "target": "notify"}
    ]
  }
}
