{
  "id": "sales-account-health-check",
  "title": "Sales: Account Health Check",
  "description": "Weekly health check for key accounts, generate a score and open renewal tasks for at-risk accounts.",
  "category": "Sales",
  "tags": ["sales","cs","health"],
  "sample_input": {"week":"2025-W32"},
  "graph": {
    "nodes": [
      {
        "id": "in",
        "type": "input",
        "position": {"x": 0, "y": 0},
        "data": {"label": "Schedule"}
      },
      {
        "id": "fetch_metrics",
        "type": "http",
        "position": {"x": 220, "y": 0},
        "data": {
          "label": "Fetch usage",
          "config": {"method": "GET", "url": "https://analytics.api/accounts/metrics?week={{ trigger.week }}"}
        }
      },
      {
        "id": "score",
        "type": "action",
        "position": {"x": 440, "y": 0},
        "data": {
          "label": "Compute score",
          "config": {
            "language": "python",
            "code": "m = node_results.fetch_metrics\n# compute heuristic score\nscores = []\nfor a in m:\n  s = a.get('usage',0) * 0.7 + a.get('support_tickets',0) * -0.3\n  scores.append({'account_id':a['id'],'score':s})\nreturn {'scores':scores}"
          }
        }
      },
      {
        "id": "open_tasks",
        "type": "http",
        "position": {"x": 660, "y": 0},
        "data": {
          "label": "Open Renewal Tasks",
          "config": {"method": "POST", "url": "https://tasks.api/create", "body": "{{ node_results.score }}"}
        }
      }
    ],
    "edges": [
      {"id": "e1", "source": "in", "target": "fetch_metrics"},
      {"id": "e2", "source": "fetch_metrics", "target": "score"},
      {"id": "e3", "source": "score", "target": "open_tasks"}
    ]
  }
}
