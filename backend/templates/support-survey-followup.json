{
  "id": "support-survey-followup",
  "title": "Support: Survey Follow-up",
  "description": "After ticket resolution, send a satisfaction survey and if negative, create a follow-up task for quality team.",
  "category": "Support",
  "tags": ["support", "survey", "followup"],
  "sample_input": {"ticket_id": "T-10"},
  "graph": {
    "nodes": [
      {
        "id": "in",
        "type": "input",
        "position": {"x": 0, "y": 0},
        "data": {"label": "Ticket Closed"}
      },
      {
        "id": "send_survey",
        "type": "email",
        "position": {"x": 220, "y": 0},
        "data": {
          "label": "Send Survey",
          "config": {
            "to": ["{{ node_results.fetch_ticket.requester_email }}"],
            "subject": "How did we do?",
            "body": "Please rate...",
            "body": { "original_config": { "to": ["{{ node_results.fetch_ticket.requester_email }}"], "subject": "How did we do?", "body": "Please rate..." } }
          }
        }
      },
      {
        "id": "collect_response",
        "type": "http",
        "position": {"x": 440, "y": 0},
        "data": {
          "label": "Collect Response",
          "config": {
            "method": "GET",
            "url": "https://support.api/surveys/{{ trigger.ticket_id }}/response"
          }
        }
      },
      {
        "id": "eval",
        "type": "action",
        "position": {"x": 660, "y": 0},
        "data": {
          "label": "Evaluate",
          "config": {
            "language": "python",
            "code": "r = json.loads(input.get('body','{}'))\nif r.get('score',5) < 4:\n    return {'followup': True}\nreturn {'followup': False}"
          }
        }
      },
      {
        "id": "create_task",
        "type": "http",
        "position": {"x": 880, "y": 0},
        "data": {
          "label": "Create Follow-up Task",
          "config": {
            "method": "POST",
            "url": "https://tasks.api/tasks",
            "body": "{{ node_results.eval }}"
          }
        }
      }
    ],
    "edges": [
      {"id": "e1", "source": "in", "target": "send_survey"},
      {"id": "e2", "source": "in", "target": "collect_response"},
      {"id": "e3", "source": "collect_response", "target": "eval"},
      {"id": "e4", "source": "eval", "target": "create_task"}
    ]
  }
}
